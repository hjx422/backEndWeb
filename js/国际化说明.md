## 本项目国际化采用[react-intl](https://github.com/yahoo/react-intl "react-intl")提供的方案.
### 硬编码文本国际化


 #### 组件中应用说明
 ```
// 1. 导包
import IntlUtil from 'i18n/intlUtil'
import { intlShape, defineMessages, FormattedMessage} from 'react-intl';
 ```
 ```
// 2. 通过前缀规范,来保证id的唯一性
const prefix = 'packageName.componentName' // 前缀命名规则:  包名.组件名
// 3. 抽取硬编码数据
const messages = defineMessages({
    textKey: {
        id: `${prefix}.textKey`, // 全局唯一的id
        defaultMessage: '请先选择竞品！', // 默认文本,当没有对应语言的翻译时,默认采用的文本
        description:'选择竞品提示语' // 说明,这个作为文本额外说明,目前尚未使用到，**可能作为翻译时的上下文提供给翻译人员，所以也请认真填写**
    },
    tip: {
        id: `${prefix}.tip`,
        defaultMessage: '请先选择{competingProduct}！', // competingProduct作为占位符
        description:'tip'
    },
    competingProduct: {
        id: `${prefix}.competingProduct`,
        defaultMessage: '竞品A',
        description: '竞品A',
    }
)
 ```
 ```
// 4. 使用
export default class competingProduct extends React.Component {
    // ... 略
    render(){
    // 4. 使用IntlUtil工具类,formatMessage
        return (
            <div>
                // 有语言包的时候将会自动根据系统语言自动翻译
                <div>{IntlUtil.formatMessage(this, messages.textKey)}</div>
                // IntlUtil.formatMessage(this, messages.competingProduct) 将会替代'请先选择{competingProduct}！'中的{competingProduct}占位符
                <div>{IntlUtil.formatMessage(this, messages.tip, {competingProduct: IntlUtil.formatMessage(this, messages.competingProduct) })}</div>
                // 假设需要在占位符中传入dom，可以使用FormattedMessage，示例如下
                <FormattedMessage
                    id={`${prefix}.picUnit`}
                    defaultMessage={'共{count}张图片，{total} M （上传过程中请不要删除原始图片）'}
                    values={{
                        count: <span className={styles['tool-font-count']}>{this.props.count }</span>,
                        total: <span className={styles['tool-font-count']}>{(this.props.size/(1024*1024)).toFixed(3)}</span>
                    }}
                />
            </div>
        )
    }
}
// 5. 声明contextTypes
competingProductsDecompose.contextTypes = {
    intl: intlShape,
}
 ```

 #### 组件外应用说明
 > 同样调用IntlUtil.formatXXX api来进行格式化.记得传入this,IntlUtil判断到不是组件,将会调用全局intl来进行格式化

 #### 时间国际化等
 > 国际化完善起来还是比较复杂的,除了简单的文本国际化,还有时间,数量等多元的需要考虑的因素.react-intl提供了完整的国际化方案,项目还没做的那么细致,主要还是只用了formatMessage后续再慢慢完善吧.

 #### 建议
 -----
  + **翻译字符串末尾的符号（如：/，/:/,），如果这串翻译后面还会接文字的话，不要写在翻译中**
  ```
    tips: {
        id: `${prefix}.tips`,
        defaultMessage: '填写tips', // 不要写成【填写tips：】
        description: '填写tips',
    }
  ```

  + **统一使用中文标点符号**

  + **请勿以国际化资源作为判断组件状态的条件**
  > 如上传文件时，以“上传成功”、“上传中”作为upload组件的state\
  > 如需使用这些状态，定义一个enum以及它们的关联使用

  + **尽量是完整的句子，否则翻译人员会因为缺少上下文翻译失误**
  ```
  // 不要分成以下的两段
    tips: {
        id: `${prefix}.otherDo`,
        defaultMessage: '其他行业是如何做到的：',
        description: '其他行业是如何做到的：',
    }
    tips: {
        id: `${prefix}.howOtherDo`,
        defaultMessage: '可以分析其他行业是如何做到的？来寻找竞品。',
        description: '可以分析其他行业是如何做到的？来寻找竞品。',
    }
  ```

  + 带序号的字符串，不要将序号写在翻译字符串中
  ```
    tips: {
        id: `${prefix}.tips1`,
        defaultMessage: '目标用户为ND产品策划，使用方法论进行设计工作是其主要工作内容。', // 不要写成【1、目标用户为ND产品策划，使用方法论进行设计工作是其主要工作内容。】
        description: '目标用户为ND产品策划，使用方法论进行设计工作是其主要工作内容。',
    }
  ```

  + 翻译中有使用到阿拉伯数字的，如【共3张图片】，建议以占位符的方式写
  ```
    upPics: {
        id: `${prefix}.upPics`,
        defaultMessage: '共{count}张图片',
        description: '共{count}张图片',
    }
  ```

  #### 国际化资源生成
> 在项目/script/lang目录中写了几个脚本,用来生成提供给翻译用的excel,以及读取翻译后的excel,导出成语言包('{lang}.json').
配置了2个命令

  ```
  // 开发时只需要执行这一步
  npm run gen_combine // 合并项目开发中定义的message=>combine.json
  // 生成combine.json过程中会输出日志，同一文件内重复翻译项警告如下
  // warn: 【config.alterItemConfig.stakeHolderNameTips14】是重复翻译项，建议修改！
  ```

  + 更新步骤
   1. 将翻译后的excel改名为`language_translated_${srcLang}2${dstLang}.xlsx`放在res/messages/lang内
   0. 执行以下命令
   0. 将生成的`language_wait_translate_${srcLang}2${dstLang}.xlsx`给翻译人员即可，内有已翻译及待翻译内容
  ```
  // 导入翻译后的资源时才需要执行这一步
  npm run translate // 导入翻译资源并生成{lang}.json，覆盖i18n目录
  ```

  + 各资源文件
   1. combine.json 中间文件，记录id以及待翻译内容
   0. language_zh2en.xlsx 已翻译内容
   0. language_translated_zh2en.xlsx 新的翻译内容，相同内容将覆盖上面的已翻译内容
   0. language_wait_translate_zh2en.xlsx 新的待翻译内容（包含已翻译部分）
   0. {lang}.json 翻译插件使用的文件